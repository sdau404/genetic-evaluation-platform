<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>遗传评估结果发布平台</title>
  <!-- 引入 Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>
  <style>
    /* 所有CSS样式保持不变... */
    body {
       font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
       margin: 0;
       padding: 0;
       color: #333;
      /* 核心：背景图 + 透明度 + 底色叠加 */
       background:
         linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.65)), /* 白色底色 + 85%不透明度（数值越小越透明） */
         url("asset/images/sdau.jpg"); /* 替换为你的背景图片地址（本地/网络） */
       background-size: cover; /* 背景图自适应屏幕大小 */
       background-position: center; /* 背景图居中显示 */
       background-attachment: fixed; /* 滚动页面时背景图固定不动 */
       background-repeat: no-repeat; /* 背景图不重复 */
       min-height: 100vh;
    }

    header {
      background-color: #2c3e50;
      color: white;
      text-align: center;
      padding: 20px 0;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 100%;
    }

    header h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 600;
    }

    nav {
      background-color: #34495e;
      padding: 10px 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      width: 100%;
      text-align: center;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    /* 左侧功能区容器（修改后） */
    .nav-left {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-left: 10px; /* 基础左侧间距，可调整 */
      justify-content: flex-end; /* 让容器内的按钮靠右排列 */
      width: 50%; /* 可选：给容器设置宽度，让按钮有足够空间靠右 */
    }

    /* 右侧操作区容器 */
    .nav-right {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-left: auto;
      margin-right: 20px;
    }

    nav a {
      margin: 0;
      padding: 10px 20px;
      background-color: #3498db;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s ease, transform 0.2s ease;
      font-size: 14px;
      cursor: pointer;
      display: inline-block;
    }

    /* 首页按钮特殊样式（区分核心功能） */
    .home-btn {
      background-color: #2ecc71 !important;
    }

    .home-btn:hover {
      background-color: #27ae60 !important;
    }

    nav a:hover {
      background-color: #2980b9;
      transform: translateY(-2px);
    }

    /* 未登录时的导航链接样式 */
    nav a.disabled {
      opacity: 0.6;
      cursor: not-allowed;
      pointer-events: none;
      background-color: #95a5a6 !important;
    }

    /* 登录后的导航链接样式 */
    nav a.enabled {
      opacity: 1;
      cursor: pointer;
      pointer-events: auto;
      background-color: #3498db;
      transition: all 0.3s ease;
    }

    .nav-btn {
      margin: 0;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      font-size: 14px;
      color: white;
      display: inline-block;
    }

    .login-btn {
      background-color: #e67e22;
    }

    .login-btn:hover {
      background-color: #d35400;
      transform: translateY(-2px);
    }

    .logout-btn {
      background-color: #e74c3c;
    }

    .logout-btn:hover {
      background-color: #c0392b;
      transform: translateY(-2px);
    }

    .view-results-btn {
      background-color: #27ae60;
    }

    .view-results-btn:hover {
      background-color: #219653;
      transform: translateY(-2px);
    }

    .search-box {
      display: none;
      position: absolute;
      right: 20px;
      top: 60px;
      background-color: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }

    .search-box input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      width: 200px;
      margin-right: 10px;
    }

    .search-box button {
      padding: 8px 12px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .search-box button:hover {
      background-color: #2980b9;
    }

    main {
      width: 80%;
      margin: 40px auto;
      padding: 40px;
      background-color: white;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }

    main h2 {
      font-size: 24px;
      color: #2c3e50;
      margin-bottom: 30px;
      text-align: center;
    }

    .publish-section {
      max-width: 600px;
      margin: 0 auto;
    }

    .publish-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      background-color: #ffffff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .publish-form:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
    }

    .publish-form input,
    .publish-form textarea,
    .publish-form select {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }

    .publish-form input:focus,
    .publish-form textarea:focus,
    .publish-form select:focus {
      border-color: #3498db;
      outline: none;
    }

    .publish-form textarea {
      resize: vertical;
      min-height: 120px;
    }

    .publish-form button {
      padding: 12px 20px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .publish-form button:hover {
      background-color: #2980b9;
      transform: translateY(-2px);
    }

    footer {
      background-color: #2c3e50;
      color: white;
      padding: 20px;
      text-align: center;
      margin-top: 40px;
      box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
    }

    .footer-buttons {
      margin-bottom: 10px;
    }

    .footer-buttons button {
      margin: 0 5px;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background-color: #3498db;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      font-size: 14px;
    }

    .footer-buttons button:hover {
      background-color: #2980b9;
      transform: translateY(-2px);
    }

    footer p {
      font-size: 12px;
      margin: 5px 0 0;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 100;
      justify-content: center;
      align-items: flex-start;
      padding: 30px 0;
      overflow-y: auto;
    }

    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      width: 100%;
      max-width: 550px;
      max-height: calc(100vh - 80px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow-y: auto;
    }

    .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #777;
    }

    .close-btn:hover {
      color: #333;
    }

    .login-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
    }

    .login-form label {
      font-weight: 600;
      color: #2c3e50;
    }

    .login-form input {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }

    .login-form button {
      padding: 12px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .login-form button:hover {
      background-color: #2980b9;
    }

    .login-form .form-footer {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-top: 5px;
    }

    .login-form .form-footer a {
      color: #3498db;
      text-decoration: none;
    }

    .login-form .form-footer a:hover {
      text-decoration: underline;
    }

    .form-group {
      margin-bottom: 12px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c3e50;
    }

    .form-row {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }

    .form-col {
      flex: 1;
    }

    .file-upload {
      border: 2px dashed #ddd;
      padding: 15px;
      text-align: center;
      border-radius: 5px;
      cursor: pointer;
      transition: border-color 0.3s ease;
    }

    .file-upload:hover {
      border-color: #3498db;
    }

    .file-upload input {
      display: none;
    }

    .file-upload p {
      margin: 5px 0;
      font-size: 14px;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      font-size: 13px;
    }

    .data-table th,
    .data-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    .data-table th {
      background-color: #f2f2f2;
    }

    .tab-container {
      margin-bottom: 15px;
    }

    .tab-buttons {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 15px;
    }

    .tab-btn {
      padding: 8px 15px;
      background: none;
      border: none;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .tab-btn.active {
      border-bottom: 3px solid #3498db;
      color: #3498db;
      font-weight: 600;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .user-info {
      color: white;
      font-size: 14px;
      margin-right: 15px;
    }

    @media (max-width: 1200px) {
      nav {
        flex-wrap: wrap;
        padding: 10px 20px;
      }
      .nav-left, .nav-right {
        margin: 5px 0;
      }
      .nav-right {
        margin-left: auto;
        margin-right: 0;
      }
    }

    @media (max-width: 768px) {
      main {
        width: 90%;
        padding: 20px;
      }

      .modal-content {
        width: 90%;
        max-height: calc(100vh - 60px);
      }

      .form-row {
        flex-direction: column;
        gap: 10px;
      }

      nav {
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }

      .nav-left, .nav-right {
        flex-direction: column;
        width: 100%;
        align-items: center;
      }

      nav a,
      .nav-btn {
        width: 80%;
        margin: 3px 0;
        text-align: center;
      }

      .user-info {
        display: none;
      }

      .search-box {
        left: 50%;
        transform: translateX(-50%);
        right: auto;
      }
    }
    /* 卡片的css样式 */
    /* 多卡片容器 */
    .img-text-cards {
      display: flex;
      gap: 25px;
      flex-wrap: wrap; /* 自动换行 */
      margin: 30px 0;
    }

    /* 单张卡片样式 */
    .img-text-card {
      flex: 1;
      min-width: 280px; /* 最小宽度，避免过窄 */
      background-color: white;
      border-radius: 12px;
      overflow: hidden; /* 裁剪圆角 */
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      transition: transform 0.3s;
    }

/* 卡片悬浮效果 */
    .img-text-card:hover {
      transform: translateY(-5px); /* 轻微上浮 */
    }

/* 卡片图片 */
    .card-img img {
      width: 100%;
      height: 180px; /* 固定图片高度，保持整齐 */
      object-fit: cover; /* 避免图片拉伸 */
    }

/* 卡片文字 */
    .card-text {
      padding: 20px;
    }

    .card-text h4 {
      color: #2c3e50;
      font-size: 18px;
      margin-bottom: 10px;
    }

    .card-text p {
      color: #666;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 15px;
    }

    .card-text a {
      color: #3498db;
      text-decoration: none;
      font-size: 14px;
      font-weight: 600;
    }

    .card-text a:hover {
      color: #2980b9;
      text-decoration: underline;
    }


  </style>
</head>

<body>
  <header>
    <h1>遗传改良信息服务平台</h1>
  </header>

  <nav>
    <!-- 左侧功能区：首页按钮 + 核心功能导航 -->
    <div class="nav-left">
      <!-- 首页按钮（添加在核心功能左侧，点击返回index） -->
      <a href="index.html" class="home-btn" title="返回首页">首页</a>

      <!-- 核心功能导航 -->
      <a id="navPhenotype" onclick="checkLoginBeforeOpen('phenotypeModal')">表型数据上传</a>
      <a id="navGenotype" onclick="checkLoginBeforeOpen('genotypeModal')">基因型数据上传</a>
      <a id="navKinship" onclick="checkLoginBeforeOpen('kinshipMatrixModal')">系谱上传</a>
      <!-- 删除 <a id="navGwas" onclick="checkLoginBeforeOpen('gwasModal')">全基因组关联分析</a>-->
      <!-- 删除 <a id="navEvaluation" onclick="checkLoginBeforeOpen('geneticEvaluationModal')">遗传评估</a>-->
      <a href="介绍.html">介绍</a>
    </div>

    <!-- 右侧操作区：用户信息 + 登录/退出/搜索按钮 -->
    <div class="nav-right">
      <!-- 用户信息 -->
      <div class="user-info" id="userInfo" style="display: none;">
        欢迎，<span id="usernameDisplay"></span>
      </div>

      <!-- 操作按钮 -->
      <button class="nav-btn login-btn" id="loginBtn" onclick="openModal('loginModal')">登录</button>
      <button class="nav-btn logout-btn" id="logoutBtn" onclick="logout()" style="display: none;">退出登录</button>
      <button class="nav-btn view-results-btn" id="viewResultsBtn" onclick="toggleSearchBox()" style="display: none;">遗传评估结果查看</button>
    </div>

    <!-- 搜索框（位置调整为右侧对齐） -->
    <div class="search-box" id="searchBox">
      <input type="text" placeholder="输入关键词搜索">
      <button onclick="searchResults()">搜索</button>
    </div>
  </nav>

  <main>
    <h2>优良猪种展览</h2>
    <!-- 多卡片图文展示区 -->
    <div class="img-text-cards">
      <!-- 卡片1 -->
      <div class="img-text-card">
        <div class="card-img">
          <img src="asset/images/sdau.jpg" alt="杜洛克猪">
        </div>
        <div class="card-text">
          <h4>杜洛克猪</h4>
          <p>是偶蹄目猪科猪属哺乳动物。其体形较小，结构紧凑；全身被毛棕色，允许体侧或腹下有少量小暗斑点；头、耳中等大小，嘴短直；背腰平直，腹线平直；体躯较宽，肌肉丰满，后躯发达，四肢粗壮结实；其以种公马杜洛克命名。瘦肉率高、生长快，三元杂交核心父本</p>
          <a href="https://baike.baidu.com/item/杜洛克猪/3891314" target="_blank" rel="noopener noreferrer">了解详情</a>
        </div>
      </div>

      <!-- 卡片2 -->
      <div class="img-text-card">
        <div class="card-img">
          <img src="asset/images/sdau.jpg" alt="长白猪">
        </div>
        <div class="card-text">
          <h4>长白猪</h4>
          <p>长白猪是偶蹄目猪科猪属哺乳动物，又名兰德瑞斯猪。体长，被毛呈白色，偶有少量暗黑色斑点。头小颈短，鼻嘴狭长，耳较大，向前倾或下垂；背腰平直，胸部稍狭窄，后驱发达，腿臀丰满，整体呈前轻后重，外观清秀美观，体质结实细致，四肢挺直；乳头6—7对，排列整齐。产仔率高、生长性能优，母本首选品种</p>
          <a href="https://baike.baidu.com/item/%E9%95%BF%E7%99%BD%E7%8C%AA/2642264" target="_blank" rel="noopener noreferrer">了解详情</a>
        </div>
      </div>

      <!-- 卡片3 -->
      <div class="img-text-card">
        <div class="card-img">
          <img src="asset/images/sdau.jpg" alt="养殖技术">
        </div>
        <div class="card-text">
          <h4>荣昌猪</h4>
          <p>荣昌猪（学名：Sus scrofa domesticus）是猪科猪属哺乳动物，世界八大优良种猪之一。体型较大，成年公猪体重约170千克，母猪约160千克；全身以白色为主，常见眼周或头部黑斑（俗称“熊猫猪”），鬃毛洁白粗长。主产于重庆荣昌区及四川隆昌市，分布于川渝十余县市并推广至全国20余省份。该品种具有耐粗饲、适应性强、遗传稳定等特点。</p>
          <a href="https://baike.baidu.com/item/%E8%8D%A3%E6%98%8C%E7%8C%AA/592684" target="_blank" rel="noopener noreferrer">了解详情</a>
        </div>
      </div>
    </div>

        <!-- 新增成员：复制上面的 .team-card 块即可 -->
        <!--
        <div class="team-card">
            <img src="头像路径" alt="姓名" class="team-avatar">
            <h3 class="team-name">姓名</h3>
            <p class="team-role">职位</p>
            <p class="team-desc">简介</p>
        </div>
        -->
    </div>
  </main>

  <footer>
    <div class="footer-buttons">
      <button>Update</button>
      <button>Citation</button>
      <button>Manual</button>
    </div>
    <p>如果发现bug，请联系我们。邮箱为ningchao@sdau.edu.cn</p>
  </footer>

  <!-- 登录模态框 -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('loginModal')">&times;</span>
      <h2 style="text-align: center;">用户登录</h2>
      <form class="login-form" id="loginForm">
        <label for="username">用户名/邮箱</label>
        <input type="text" id="username" placeholder="请输入用户名或邮箱" required>

        <label for="password">密码</label>
        <input type="password" id="password" placeholder="请输入密码" required>

        <button type="submit">登录</button>
        <div class="form-footer">
          <a href="#" onclick="switchModal('registerModal')">注册账号</a>
        </div>
      </form>
    </div>
  </div>

  <!-- 注册模态框 -->
  <div class="modal" id="registerModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('registerModal')">&times;</span>
      <h2 style="text-align: center;">用户注册</h2>
      <form class="login-form" id="registerForm">
        <label for="regUsername">用户名</label>
        <input type="text" id="regUsername" placeholder="请输入用户名（3-20位）" required>

        <label for="regEmail">邮箱</label>
        <input type="email" id="regEmail" placeholder="请输入用于注册的邮箱" required>

        <label for="regPassword">密码</label>
        <input type="password" id="regPassword" placeholder="请输入密码（6-20位）" required>

        <label for="regConfirmPassword">确认密码</label>
        <input type="password" id="regConfirmPassword" placeholder="请再次输入密码" required>

        <button type="submit">注册</button>
        <div class="form-footer">
          <a href="#" onclick="switchModal('loginModal')">已有账号？去登录</a>
        </div>
      </form>
    </div>
  </div>

  <!-- 简单的表型数据处理模态框（其他类似） -->
  <div class="modal" id="phenotypeModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('phenotypeModal')">&times;</span>
      <h2>表型数据处理</h2>
      <div class="publish-form">
        <div class="form-group">
          <label for="phenotype-file">上传表型数据文件</label>
          <div class="file-upload" onclick="document.getElementById('phenotype-file').click()">
            <input type="file" id="phenotype-file" accept=".csv, .xlsx, .txt">
            <p>点击或拖拽文件到此处</p>
            <p>支持格式: CSV, Excel, TXT</p>
          </div>
        </div>
        <div class="form-group">
          <label for="phenotype-name">数据集名称</label>
          <input type="text" id="phenotype-name" placeholder="输入数据集名称" required>
        </div>
        <button type="submit">上传数据</button>
      </div>
    </div>
  </div>

  <!-- 基因型数据处理模态框 -->
  <div class="modal" id="genotypeModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('genotypeModal')">&times;</span>
      <h2>基因型数据处理</h2>
      <div class="publish-form">
        <div class="form-group">
          <label for="genotype-file">上传基因型数据文件</label>
          <div class="file-upload" onclick="document.getElementById('genotype-file').click()">
            <input type="file" id="genotype-file" accept=".vcf, .ped, .map, .bed">
            <p>点击或拖拽文件到此处</p>
            <p>支持格式: VCF, PED/MAP, BED/BIM/FAM</p>
          </div>
        </div>
        <div class="form-group">
          <label for="genotype-name">数据集名称</label>
          <input type="text" id="genotype-name" placeholder="输入数据集名称" required>
        </div>
        <button type="submit">上传数据</button>
      </div>
    </div>
  </div>

  <!-- 亲缘关系矩阵计算模态框 -->
  <div class="modal" id="kinshipMatrixModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('kinshipMatrixModal')">&times;</span>
      <h2>亲缘关系矩阵计算</h2>
      <div class="publish-form">
        <div class="form-group">
          <label for="kinship-file">上传亲缘关系矩阵文件</label>
          <div class="file-upload" onclick="document.getElementById('kinship-file').click()">
            <input type="file" id="kinship-file" accept=".csv, .txt, .matrix">
            <p>点击或拖拽文件到此处</p>
            <p>支持格式: CSV, TXT, MATRIX</p>
          </div>
        </div>
        <div class="form-group">
          <label for="kinship-name">矩阵名称</label>
          <input type="text" id="kinship-name" placeholder="输入矩阵名称" required>
        </div>
        <button type="submit">上传矩阵</button>
      </div>
    </div>
  </div>

  <!-- 全基因组关联分析模态框 -->
  <div class="modal" id="gwasModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('gwasModal')">&times;</span>
      <h2>全基因组关联分析（GWAS）</h2>
      <div class="publish-form">
        <div class="form-group">
          <label for="gwas-file">上传GWAS结果文件</label>
          <div class="file-upload" onclick="document.getElementById('gwas-file').click()">
            <input type="file" id="gwas-file" accept=".csv, .txt, .gwas">
            <p>点击或拖拽文件到此处</p>
            <p>支持格式: CSV, TXT, GWAS</p>
          </div>
        </div>
        <div class="form-group">
          <label for="gwas-name">分析名称</label>
          <input type="text" id="gwas-name" placeholder="输入分析名称" required>
        </div>
        <button type="submit">上传结果</button>
      </div>
    </div>
  </div>

  <!-- 遗传评估模态框 -->
  <!-- 新：遗传评估结果查看模态框 -->
  <div class="modal" id="geneticEvaluationModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('geneticEvaluationModal')">&times;</span>
      <h2>遗传评估结果查看</h2>

      <!-- 筛选条件（默认筛选猪） -->
      <div class="publish-form" style="margin-bottom: 20px;">
        <div class="form-row">
          <div class="form-col">
            <label for="eval-species">物种筛选</label>
            <select id="eval-species" onchange="filterEvalResults()">
              <option value="all">全部</option>
              <option value="猪" selected>猪</option>
              <option value="牛">牛</option>
              <option value="羊">羊</option>
            </select>
          </div>
          <div class="form-col">
            <label for="eval-trait">性状类型</label>
            <select id="eval-trait" onchange="filterEvalResults()">
              <option value="all">全部</option>
              <option value="生长性状">生长性状</option>
              <option value="繁殖性状">繁殖性状</option>
              <option value="肉质性状">肉质性状</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="eval-search">关键词搜索</label>
          <input type="text" id="eval-search" placeholder="输入评估名称/猪种名" oninput="filterEvalResults()">
        </div>
      </div>

    <!-- 结果列表 -->
      <div style="max-height: 400px; overflow-y: auto;">
        <table class="data-table" id="eval-results-table">
          <thead>
            <tr>
              <th>评估名称</th>
              <th>猪种/物种</th>
              <th>性状类型</th>
              <th>评估时间</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody id="eval-results-body">
            <!-- 动态渲染结果 -->
          </tbody>
        </table>
        <div id="eval-no-result" style="text-align: center; padding: 20px; display: none;">
          未找到匹配的遗传评估结果～
        </div>
      </div>

      <!-- 结果详情弹窗 -->
      <div id="eval-detail-modal" style="display: none; margin-top: 20px; padding: 15px; border: 1px solid #eee; border-radius: 8px; background: #f9f9f9;">
        <h4 style="margin-top: 0;" id="detail-title">评估详情</h4>
        <div id="detail-content">
          <!-- 动态渲染详情 -->
        </div>
        <button onclick="closeEvalDetail()" style="margin-top: 10px; padding: 8px 15px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">关闭详情</button>
      </div>
    </div>
  </div>

<script>
// 修复的JavaScript代码
// 1. 修复Supabase初始化
let supabaseClient = null;

document.addEventListener('DOMContentLoaded', function() {
  initSupabase();
  updateLoginStatus();
});

function initSupabase() {
  try {
    window.sb = supabase.createClient(
      "https://cwpdenrqhipxgkcwewtv.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN3cGRlbnJxaGlweGdrY3dld3R2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NDM5MzUsImV4cCI6MjA4MTUxOTkzNX0.qLvLmBeu00kCZ7rvQUd4iBQFxR4lDkRLqIRM44JZ3i4",
      {
        auth: {
          persistSession: true,
          autoRefreshToken: true,
          detectSessionInUrl: true,
          storage: localStorage
        },
        global: {
          headers: {
            'X-Client-Info': 'supabase-js/2.38.4'
          }
        }
      }
    );
    supabaseClient = window.sb;
    console.log("Supabase 初始化完成");
  } catch (error) {
    console.warn("Supabase 初始化失败，使用离线模式：", error);
    // 即使Supabase初始化失败，也允许页面继续运行
    window.sb = null;
  }
}

// 2. 基础模态框函数（添加错误检查）
function openModal(modalId) {
  const modal = document.getElementById(modalId);
  if (!modal) {
    console.error('未找到模态框：', modalId);
    alert('功能暂不可用，请检查页面是否完整加载');
    return;
  }
  modal.style.display = 'flex';
}

function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.style.display = 'none';
  }
}

// 3. 检查登录状态的通用函数（修复版）
function checkLoginBeforeOpen(modalId) {
  // 先检查模态框是否存在
  const modal = document.getElementById(modalId);
  if (!modal) {
    console.error('未找到模态框：', modalId);
    alert('功能暂不可用，请刷新页面重试！');
    return;
  }

  // 如果Supabase不可用，直接打开模态框（离线模式）
  if (!window.sb) {
    console.warn('Supabase不可用，使用离线模式');
    openModal(modalId);
    return;
  }

  // 检查登录状态
  window.sb.auth.getSession().then(({ data: { session } }) => {
    if (session) {
      openModal(modalId);
    } else {
      alert('请先登录后使用此功能！');
      // 确保登录模态框存在
      const loginModal = document.getElementById('loginModal');
      if (loginModal) {
        openModal('loginModal');
      } else {
        alert('登录功能暂不可用，请刷新页面重试！');
      }
    }
  }).catch(error => {
    console.error("检查登录状态失败:", error);
    alert('检查登录状态失败，请重试！');
  });
}

// 4. 更新导航栏状态
function updateNavbarStatus(isLogin) {
  const navLinks = [
    'navPhenotype',
    'navGenotype',
    'navKinship',
    'navGwas',
    'navEvaluation'
  ];

  navLinks.forEach(id => {
    const link = document.getElementById(id);
    if (link) {
      if (isLogin) {
        link.classList.remove('disabled');
        link.classList.add('enabled');
      } else {
        link.classList.remove('enabled');
        link.classList.add('disabled');
      }
    }
  });
}

// 5. 更新登录状态（修复版）
async function updateLoginStatus() {
  // 如果Supabase不可用，假设用户未登录
  if (!window.sb) {
    console.warn('Supabase不可用，使用离线模式');
    document.getElementById('userInfo').style.display = 'none';
    document.getElementById('loginBtn').style.display = 'inline-block';
    document.getElementById('logoutBtn').style.display = 'none';
    document.getElementById('viewResultsBtn').style.display = 'none';
    document.getElementById('publishForm').querySelector('button[type="submit"]').disabled = true;
    updateNavbarStatus(false);
    return;
  }

  try {
    const { data: { session }, error: sessionError } = await window.sb.auth.getSession();
    if (sessionError) {
      console.error("获取登录状态失败：", sessionError);
      updateNavbarStatus(false);
      return;
    }

    const isLogin = !!session;
    const user = session?.user;

    document.getElementById('userInfo').style.display = isLogin ? 'block' : 'none';
    if (isLogin) {
      document.getElementById('usernameDisplay').textContent = user.email || user.user_metadata?.username || '未知用户';
    }

    document.getElementById('loginBtn').style.display = isLogin ? 'none' : 'inline-block';
    document.getElementById('logoutBtn').style.display = isLogin ? 'inline-block' : 'none';
    document.getElementById('viewResultsBtn').style.display = isLogin ? 'inline-block' : 'none';


    updateNavbarStatus(isLogin);
  } catch (error) {
    console.error('更新登录状态出错:', error);
    updateNavbarStatus(false);
  }
}

// 6. 登录表单提交
document.getElementById('loginForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();

  if (!username || !password) {
    alert('请输入用户名/邮箱和密码！');
    return;
  }

  // 如果Supabase不可用，模拟登录
  if (!window.sb) {
    console.warn('Supabase不可用，使用模拟登录');
    alert('登录成功！欢迎 测试用户');
    // 模拟更新登录状态
    document.getElementById('userInfo').style.display = 'block';
    document.getElementById('usernameDisplay').textContent = '测试用户';
    document.getElementById('loginBtn').style.display = 'none';
    document.getElementById('logoutBtn').style.display = 'inline-block';
    document.getElementById('viewResultsBtn').style.display = 'inline-block';
    document.getElementById('publishForm').querySelector('button[type="submit"]').disabled = false;
    updateNavbarStatus(true);
    closeModal('loginModal');
    this.reset();
    return;
  }

  try {
    const { data, error } = await window.sb.auth.signInWithPassword({
      email: username,
      password: password,
    });

    if (error) {
      throw error;
    }

    const userName = data.user.email || data.user.user_metadata?.username || '未知用户';
    alert(`登录成功！欢迎 ${userName}`);
    updateLoginStatus();
    closeModal('loginModal');
    this.reset();
  } catch (error) {
    console.error('登录失败:', error);
    alert(`登录失败：${error.message}`);
  }
});

// 7. 退出登录
async function logout() {
  // 如果Supabase不可用，模拟登出
  if (!window.sb) {
    console.warn('Supabase不可用，使用模拟登出');
    alert('退出登录成功！');
    updateLoginStatus();
    return;
  }

  try {
    const { error } = await window.sb.auth.signOut();
    if (error) {
      throw error;
    }
    alert('退出登录成功！');
    updateLoginStatus();
  } catch (error) {
    console.error('退出登录失败:', error);
    alert(`退出失败：${error.message}`);
  }
}

// 8. 切换模态框
function switchModal(targetModalId) {
  const modals = document.querySelectorAll('.modal');
  modals.forEach(modal => {
    if (modal.style.display === 'flex') {
      modal.style.display = 'none';
    }
  });

  openModal(targetModalId);
}

// 9. 搜索框切换
function toggleSearchBox() {
  const searchBox = document.getElementById('searchBox');
  if (searchBox) {
    searchBox.style.display = searchBox.style.display === 'block' ? 'none' : 'block';
  }
}


// 11. 点击模态框外部关闭功能
document.addEventListener('click', function(e) {
  const modals = document.querySelectorAll('.modal');
  modals.forEach(modal => {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  });
});

// 12. 按ESC键关闭模态框
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
      modal.style.display = 'none';
    });
  }
});

// 13. 搜索功能（补充实现）
function searchResults() {
  const searchInput = document.querySelector('.search-box input').value.trim();
  const resultSection = document.getElementById('searchResultSection');
  const resultBody = document.getElementById('searchResultBody');
  const noResultTip = document.getElementById('noResultTip');

  // 清空之前的结果
  resultBody.innerHTML = '';

  if (!searchInput) {
    alert('请输入搜索关键词！');
    return;
  }

  // 模拟搜索结果（实际项目中替换为Supabase查询）
  const mockResults = [
    { title: '牛生长性状遗传评估', species: '牛', trait: '生长性状', time: '2025-01-15' },
    { title: '猪繁殖性状GWAS分析', species: '猪', trait: '繁殖性状', time: '2025-01-10' },
    { title: '羊产肉性状遗传参数估计', species: '羊', trait: '肉质性状', time: '2025-01-05' }
  ];

  // 过滤匹配结果
  const matchedResults = mockResults.filter(item =>
    item.title.includes(searchInput) ||
    item.species.includes(searchInput) ||
    item.trait.includes(searchInput)
  );

  // 显示结果
  resultSection.style.display = 'block';
  if (matchedResults.length > 0) {
    noResultTip.style.display = 'none';
    matchedResults.forEach(item => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.title}</td>
        <td>${item.species}</td>
        <td>${item.trait}</td>
        <td>${item.time}</td>
        <td><button style="padding:5px 10px; background:#3498db; color:white; border:none; border-radius:3px; cursor:pointer;">查看详情</button></td>
      `;
      resultBody.appendChild(row);
    });
  } else {
    noResultTip.style.display = 'block';
  }
}
</script>

</body>
</html>